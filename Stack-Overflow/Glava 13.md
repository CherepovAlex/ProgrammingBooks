# Глава 13. Класс StringBuilder

[Раздел 13.1. Сравнение StringBuffer, StringBuilder, Formatter и StringJoiner](#раздел-131-сравнение-stringbuffer-stringbuilder-formatter-и-stringjoiner)

[Раздел 13.2. Повторение строки n раз](#раздел-132-повторение-строки-n-раз)

Класс Java `StringBuilder` используется для создания изменяемой (модифицируемой) строки. Класс `StringBuilder` аналогичен классу `StringBuffer`, за исключением того, что он несинхронизирован. Он доступен начиная с версии JDK 1.5.

## Раздел 13.1. Сравнение StringBuffer, StringBuilder, Formatter и StringJoiner

Классы `StringBuffer`, `StringBuilder`, `Formatter` и `StringJoiner` - это служебные классы Java SE, которые в основном используются для сборки строк на основе другой информации:

+ Класс `StringBuffer` существует с версии Java 1.0 и предоставляет множество методов для создания и модификации "буфера", содержащего последовательность символов.
+ Класс `StringBuilder` был добавлен в Java 5 для решения проблем с производительностью исходного класса `StringBuffer`. API для этих двух классов по сути одинаковы. Основное различие между `StringBuffer` и `StringBuilder` заключается в том, что первый является потокобезопасным и синхронизированным, а второй - нет.

В этом примере показано, как можно использовать `StringBuilder`:

```java
String color = "red";
StringBuilder sb = new StringBuilder();
sb.append("One=").append(one).append(", Color=").append(color).append('\n');
System.out.println(sb);
// Выводит "One=1, Color=red", после чего следует символ ASCII перевод строки.
```

(Класс `StringBuffer` используется аналогичным образом: просто замените `StringBuilder` на `StringBuffer` в приведённом выше примере).

Классы `StringBuffer` и `StringBuilder` подходят как для сборки, так и для модификации строк, т.е. предоставляют методы замены и удаления символов, а также их добавления в различные строки. Остальные два класса предназначены для задачи сборки строк.

+ Класс `Formatter` был добавлен в Java 5 и в общих чертах повторяет функцию `sprintf` стандартной библиотеки языка `C`. Он принимает строку-шаблон `format` со встроенными _спецификаторами формата_ и последовательностью других аргументов и генерирует строку, преобразуя аргументы в текст и подставляя их вместо спецификаторов формата. В спецификаторах формата указывается, как именно аргументы преобразуются в текст.
+ Класс `StringJoiner` был добавлен в Java 8. Он представляет собой специализированный форматтер, который лаконично форматирует последовательность строк с разделителями между ними. Он разработан на основе _Fluent API_ и может использоваться с потоками в Java 8.

Приведём несколько типичных примеров использования класса `Formatter`:

```java
// Этот фрагмент программы делает то же самое, что и приведённый выше пример с классом StringBuilder
int one = 1;
String color = "red";
Formatter f = new Formatter();
System.out.printf(f.format("One=%d, color=%s%n", one, color));
// Выводит "One=1, color=red", за которым следует символ перевода строки

// То же самое только с использованием удобного метода 'String.format'.
System.out.print(String.format("One=%d, color=%s%n", one, color));
```

Класс `StringJoiner` не является идеальным для решения предыдущей задачи, поэтому приведём пример форматирования массива строк.

```java
StringJoiner sj = new StringJoiner(", ", "[", "]");
for (String s: new String[]{"A", "B", "C"}) {
    sj.add(s);
}
System.out.println(sj);
// Выводит на экран "[A, B, C']".
```

Можно обобщить примеры использования 4 классов:
+ Класс `StringBuilder`, пригоден для решения любых задач сборки строк ИЛИ модификации строк.
+ Класс `StringBuffer` используется (только) в тех случаях, когда требуется потокобезопасная версия `StringBuilder`.
+ Класс`Formatter` предоставляет гораздо более богатые возможности форматирования строк, но не так эффективен, как класс `StringBuilder`. Это связано с тем, что каждый вызов `Formatter.format(...)` влечёт за собой:
  + разбор строки шаблона,
  + создание и заполнение массива `varargs`, а также автоупаковку любых аргументов примитивного типа.
+ `StringJoiner` обеспечивает лаконичное и эффективное форматирование последовательности строк с разделителями, но не подходит для решения других задач форматирования.

[к оглавлению Глава 13](#глава-13-класс-stringbuilder)

## Раздел 13.2. Повторение строки n раз

Задача: Создать строку, содержащую `n` повторений строки `s`. Тривиальный подход заключается в многократном повторении конкатенации строки `s`.

```java
final int n = ...
final String s = ...
String result = "";

for (int i = 0; i < n; i++) {
    result += s;
}
```

При этом создаётся `n` новых экземпляров строк, содержащих от 1 до `n` повторений строки `s`, что приводит к очень большому времени выполнения `O(s.length() * n^2) = O(s.length() * (1+2+...+(n-1)+n))`.

Чтобы избежать этого, следует использовать класс `StringBuilder`, который позволяет создать строку за время `O(s.length() * n)`:

```java
final int n = ...
final String s = ...

StringBuilder builder = new StringBuilder();

for (int i = 0; i < n; i++) {
    builder.append(s);
}

String resul = builder.toString();
```

[к оглавлению Глава 13](#глава-13-класс-stringbuilder)